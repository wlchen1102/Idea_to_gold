(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{57:(e,t,l)=>{Promise.resolve().then(l.bind(l,1404))},1404:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>i});var r=l(5155),a=l(2115),s=l(2099),n=l(6766);let i=function(){let[e,t]=(0,a.useState)(null),[l,i]=(0,a.useState)(""),[d,c]=(0,a.useState)(""),[o,u]=(0,a.useState)(""),[f,m]=(0,a.useState)(!1),[x,b]=(0,a.useState)(""),[h,g]=(0,a.useState)(!0),p=(0,a.useRef)(!1);(0,a.useEffect)(()=>{(async()=>{if(!p.current){p.current=!0,g(!0);try{let e=(0,s.$)(),{data:{session:l}}=await e.auth.getSession(),r=null==l?void 0:l.access_token;if(!r){b("请先登录"),g(!1);return}let a=await fetch("/api/users/me/profile",{headers:{Authorization:"Bearer ".concat(r)},cache:"no-store"});if(!a.ok){let e=await a.text();b("加载用户资料失败: ".concat(e)),g(!1);return}let n=await a.json();n.profile?(t(n.profile),i(n.profile.nickname||""),c(n.profile.avatar_url||""),u(n.profile.bio||"")):b("未找到用户资料")}catch(e){console.error("加载用户资料失败:",e),b("加载用户资料失败")}finally{g(!1)}}})()},[]);let y=async()=>{m(!0),b("");try{let t=(0,s.$)(),{data:{session:r}}=await t.auth.getSession();if(!(null==r?void 0:r.access_token))return void b("登录已过期，请重新登录");let a=await fetch("/api/users/me/profile",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.access_token)},body:JSON.stringify({nickname:l.trim()||null,bio:o.trim()||null})});if(a.ok)b("保存成功！"),window.dispatchEvent(new CustomEvent("auth:changed",{detail:{userId:null==e?void 0:e.id}}));else{let e=await a.text();b("保存失败: ".concat(e))}}catch(e){console.error("保存失败:",e),b("保存失败，请重试")}finally{m(!1)}},j=h||!e||f;return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"mx-auto max-w-2xl px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"账户设置"}),(x||!e&&!h)&&(0,r.jsxs)("div",{className:"mb-4 p-3 rounded-lg text-sm ".concat(x.includes("成功")?"bg-green-50 text-green-800":"bg-yellow-50 text-yellow-800"),children:[x||"未登录状态下信息不可编辑，请先登录。",!e&&(0,r.jsx)("a",{href:"/login",className:"ml-3 underline text-emerald-700 hover:text-emerald-800",children:"去登录"})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"grid gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"头像"}),(0,r.jsx)("div",{className:"flex items-center gap-4",children:h?(0,r.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-200 animate-pulse"}):d?(0,r.jsx)(n.default,{src:d,alt:"用户头像",width:64,height:64,unoptimized:!0,className:"h-16 w-16 rounded-full object-cover border-2 border-gray-200",onError:e=>{e.currentTarget.style.display="none"}}):(0,r.jsx)("div",{className:"h-16 w-16 rounded-full bg-emerald-500 text-white flex items-center justify-center text-lg font-bold",children:(null==l?void 0:l.charAt(0))||"用"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"用户ID"}),(0,r.jsx)("input",{type:"text",value:(null==e?void 0:e.id)||"",placeholder:h?"加载中...":e?e.id:"未登录",disabled:!0,className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-3 py-2 text-gray-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"昵称"}),(0,r.jsx)("input",{type:"text",value:l,onChange:e=>i(e.target.value),placeholder:h?"加载中...":"请输入昵称",disabled:j,className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:bg-gray-50 disabled:text-gray-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"个人简介"}),(0,r.jsx)("textarea",{value:o,onChange:e=>u(e.target.value),placeholder:h?"加载中...":"请输入个人简介",rows:4,disabled:j,className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:bg-gray-50 disabled:text-gray-500"})]})]})}),x&&(0,r.jsx)("div",{className:"p-3 rounded-lg text-sm ".concat(x.includes("成功")?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:x}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{onClick:y,disabled:f||h||!e,className:"rounded-lg bg-emerald-600 px-6 py-2 text-white font-semibold hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",children:f?"保存中...":h||!e?"等待数据...":"保存更改"})})]})]})})})}},2099:(e,t,l)=>{"use strict";l.d(t,{$:()=>i});var r=l(2354);let a="https://bkvbvmgcqfnxokklsxus.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrdmJ2bWdjcWZueG9ra2xzeHVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3OTExNjIsImV4cCI6MjA3MDM2NzE2Mn0.uNkB5g0owHKEumiPDzek1K0ZaSDdIJhPT6FwHh0hmJ0",n=a&&s?(0,r.UU)(a,s):null;function i(){if(!a||!s)throw Error("缺少 Supabase 前端环境变量，请配置以下任一组合：\n1) NEXT_PUBLIC_SUPABASE_URL 和 NEXT_PUBLIC_SUPABASE_ANON_KEY\n或\n2) VITE_SUPABASE_URL 和 VITE_SUPABASE_ANON_KEY");if(!n)throw Error("Supabase 客户端未初始化，请刷新页面或检查环境变量");return n}},6654:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return a}});let r=l(2115);function a(e,t){let l=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useCallback)(r=>{if(null===r){let e=l.current;e&&(l.current=null,e());let t=a.current;t&&(a.current=null,t())}else e&&(l.current=s(e,r)),t&&(a.current=s(t,r))},[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let l=e(t);return"function"==typeof l?l:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}},e=>{e.O(0,[354,766,441,964,358],()=>e(e.s=57)),_N_E=e.O()}]);