(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[558],{283:(e,t,r)=>{"use strict";r.d(t,{As:()=>i,AuthProvider:()=>o,XI:()=>c});var s=r(5155),a=r(2115),n=r(2099);let l=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)({user:null,authUser:null,session:null,loading:!0,token:null,userId:null}),i=async e=>{try{let t=(0,n.$)(),{data:r,error:s}=await t.from("profiles").select("id, nickname, avatar_url").eq("id",e).single();if(s)return console.warn("获取用户资料失败:",s),null;return r}catch(e){return console.warn("获取用户资料异常:",e),null}},c=(0,a.useCallback)(async e=>{var t;let r=null;(null==e?void 0:e.user)&&(r=await i(e.user.id)),o({user:r,authUser:(null==e?void 0:e.user)||null,session:e,loading:!1,token:(null==e?void 0:e.access_token)||null,userId:(null==e||null==(t=e.user)?void 0:t.id)||null})},[]),d=async()=>{try{let e=(0,n.$)(),{data:{session:t},error:r}=await e.auth.getSession();if(r){console.warn("获取认证状态失败:",r),await c(null);return}await c(t)}catch(e){console.warn("刷新认证状态异常:",e),await c(null)}},u=async()=>{try{let e=(0,n.$)();await e.auth.signOut(),await c(null),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userId")}catch(e){console.warn("登出失败:",e)}};(0,a.useEffect)(()=>{let e=!0,t=null;return(async()=>{try{let r=(0,n.$)(),{data:{session:s},error:a}=await r.auth.getSession();a&&console.warn("初始化认证状态失败:",a),e&&await c(s);let{data:l}=r.auth.onAuthStateChange(async(t,r)=>{e&&(await c(r),(null==r?void 0:r.user)?(localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",r.user.id)):(localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userId")))});t=l}catch(t){console.warn("认证初始化异常:",t),e&&o(e=>({...e,loading:!1}))}})(),()=>{if(e=!1,t)try{t.subscription.unsubscribe()}catch(e){console.warn("取消认证监听器失败:",e)}}},[c]);let m={...r,refreshAuth:d,logout:u,signOut:u};return(0,s.jsx)(l.Provider,{value:m,children:t})}function i(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let{authUser:e,loading:t}=i();return!t&&!!e}},347:()=>{},1666:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c",variable:"__variable_e8ce0c"}},2099:(e,t,r)=>{"use strict";r.d(t,{$:()=>o});var s=r(2354);let a="https://bkvbvmgcqfnxokklsxus.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrdmJ2bWdjcWZueG9ra2xzeHVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3OTExNjIsImV4cCI6MjA3MDM2NzE2Mn0.uNkB5g0owHKEumiPDzek1K0ZaSDdIJhPT6FwHh0hmJ0",l=a&&n?(0,s.UU)(a,n):null;function o(){if(!a||!n)throw Error("缺少 Supabase 前端环境变量，请配置以下任一组合：\n1) NEXT_PUBLIC_SUPABASE_URL 和 NEXT_PUBLIC_SUPABASE_ANON_KEY\n或\n2) VITE_SUPABASE_URL 和 VITE_SUPABASE_ANON_KEY");if(!l)throw Error("Supabase 客户端未初始化，请刷新页面或检查环境变量");return l}},2731:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(5155);function a(e){let{size:t="md",className:r=""}=e;return(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full border-gray-200 border-t-emerald-500 ".concat({sm:"h-8 w-8 border-2",md:"h-14 w-14 border-3",lg:"h-24 w-24 border-4"}[t]," ").concat(r)})}},2763:(e,t,r)=>{"use strict";r.d(t,{LoadingProvider:()=>i});var s=r(5155),a=r(2115),n=r(5695),l=r(2731);let o=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[r,l]=(0,a.useState)(!1),[i,d]=(0,a.useState)(void 0),u=(0,n.usePathname)(),m=e=>{l(e),e||d(void 0)};return(0,a.useEffect)(()=>{if(r){let e=setTimeout(()=>{m(!1)},100);return()=>clearTimeout(e)}},[u,r]),(0,s.jsxs)(o.Provider,{value:{isLoading:r,setLoading:m,loadingText:i,setLoadingText:d},children:[t,r&&(0,s.jsx)(c,{text:i})]})}function c(e){let{text:t}=e;return(0,s.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/20 backdrop-blur-sm",children:(0,s.jsx)("div",{className:"rounded-2xl bg-white p-8 shadow-2xl",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsx)(l.A,{size:"lg"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-lg font-medium text-[#2c3e50]",children:t||"正在加载..."}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"请稍候片刻"})]})]})})})}},5369:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});var s=r(5155),a=r(2115);function n(){let[e,t]=(0,a.useState)("");return((0,a.useEffect)(()=>{let e="pendingToast";function r(){let r=localStorage.getItem(e);r&&(t(r),localStorage.removeItem(e),setTimeout(()=>t(""),2500))}r();let s=t=>{t.key===e&&t.newValue&&r()},a=()=>{r()};return window.addEventListener("storage",s),window.addEventListener("localToast",a),()=>{window.removeEventListener("storage",s),window.removeEventListener("localToast",a)}},[]),e)?(0,s.jsx)("div",{className:"pointer-events-none fixed top-1/4 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[60]",children:(0,s.jsxs)("div",{className:"pointer-events-auto flex items-center gap-2 rounded-lg bg-gray-900/90 px-4 py-2 text-sm text-white shadow-lg",children:[(0,s.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDE80"}),(0,s.jsx)("span",{children:e})]})}):null}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},6300:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,1666,23)),Promise.resolve().then(r.t.bind(r,347,23)),Promise.resolve().then(r.bind(r,2763)),Promise.resolve().then(r.bind(r,8521)),Promise.resolve().then(r.bind(r,5369)),Promise.resolve().then(r.bind(r,283))},8521:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var s=r(5155),a=r(6874),n=r.n(a),l=r(2115),o=r(6766),i=r(283);let c=function(){var e;let[t,r]=(0,l.useState)(!1),{user:a,logout:c}=(0,i.As)(),d=async()=>{try{r(!1),await c(),window.location.href="/"}catch(e){console.error("登出失败:",e)}},u=()=>{r(!1)};return a?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>r(!t),className:"flex items-center gap-3 rounded-full bg-white p-1 shadow-sm ring-1 ring-gray-200 hover:shadow-md transition-shadow",children:[a.avatar_url?(0,s.jsx)(o.default,{src:a.avatar_url,alt:"用户头像",width:32,height:32,className:"w-8 h-8 rounded-full object-cover"}):(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white text-sm font-medium",children:(null==(e=a.nickname)?void 0:e.charAt(0).toUpperCase())||"U"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:a.nickname||"用户"})]}),t&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 rounded-lg bg-white py-2 shadow-lg ring-1 ring-gray-200",children:[(0,s.jsx)(n(),{href:"/projects",onClick:u,className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"我的项目"}),(0,s.jsx)(n(),{href:"/profile/".concat(null==a?void 0:a.id),onClick:u,className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"个人中心"}),(0,s.jsx)(n(),{href:"/settings/account",onClick:u,className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"账户设置"}),(0,s.jsx)("button",{onClick:d,className:"block w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 hover:text-red-700",children:"退出登录"})]})]}):null};var d=r(5695);let u=function(){let e=(0,i.XI)(),t=(0,d.usePathname)(),r=e=>t===e||t.startsWith(e+"/");return(0,s.jsx)("nav",{className:"sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-sm",children:(0,s.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex h-16 items-center justify-between",children:[(0,s.jsxs)(n(),{href:"/",className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold text-sm",children:"点"}),(0,s.jsx)("span",{className:"text-xl font-bold text-gray-900",children:"点子成金"})]}),(0,s.jsxs)("div",{className:"hidden gap-8 md:flex",role:"navigation",children:[(0,s.jsx)(n(),{href:"/creatives",className:"text-base font-medium transition-colors px-1 pb-1 border-b-2 ".concat(r("/creatives")?"text-emerald-600 border-emerald-500":"text-gray-700 hover:text-emerald-600 border-transparent"),"aria-current":r("/creatives")?"page":void 0,children:"创意广场"}),(0,s.jsx)(n(),{href:"#",className:"text-base font-medium text-gray-700 hover:text-emerald-600 transition-colors px-1 pb-1 border-b-2 border-transparent",children:"产品库"})]}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:e?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(c,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n(),{href:"/login",className:"rounded-lg border border-gray-300 px-6 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50",children:"登录"}),(0,s.jsx)(n(),{href:"/login?mode=signup",className:"rounded-lg bg-gradient-to-r from-emerald-500 to-emerald-600 px-6 py-2 text-sm font-semibold text-white shadow-md transition-all hover:shadow-lg hover:brightness-110",children:"立即免费注册"})]})})]})})})}}},e=>{e.O(0,[258,874,354,766,441,964,358],()=>e(e.s=6300)),_N_E=e.O()}]);