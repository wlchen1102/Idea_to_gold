(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[415],{2099:(e,t,a)=>{"use strict";a.d(t,{$:()=>i});var s=a(2354);let r="https://bkvbvmgcqfnxokklsxus.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrdmJ2bWdjcWZueG9ra2xzeHVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3OTExNjIsImV4cCI6MjA3MDM2NzE2Mn0.uNkB5g0owHKEumiPDzek1K0ZaSDdIJhPT6FwHh0hmJ0",l=r&&n?(0,s.UU)(r,n):null;function i(){if(!r||!n)throw Error("缺少 Supabase 前端环境变量，请配置以下任一组合：\n1) NEXT_PUBLIC_SUPABASE_URL 和 NEXT_PUBLIC_SUPABASE_ANON_KEY\n或\n2) VITE_SUPABASE_URL 和 VITE_SUPABASE_ANON_KEY");if(!l)throw Error("Supabase 客户端未初始化，请刷新页面或检查环境变量");return l}},2731:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(5155);function r(e){let{size:t="md",className:a=""}=e;return(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full border-gray-200 border-t-emerald-500 ".concat({sm:"h-8 w-8 border-2",md:"h-14 w-14 border-3",lg:"h-24 w-24 border-4"}[t]," ").concat(a)})}},3013:(e,t,a)=>{Promise.resolve().then(a.bind(a,9171))},3540:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(5155);function r(e){return"string"==typeof e?e:e>=1e6?"".concat((e/1e6).toFixed(1),"m"):e>=1e3?"".concat((e/1e3).toFixed(1),"k"):String(e)}function n(e){let{authorName:t,authorAvatarUrl:a,publishedAtText:n,title:l,description:i,tags:c=[],upvoteCount:o,commentCount:d,onUpvote:u,onCardClick:m,className:h=""}=e;return(0,s.jsxs)("div",{onClick:m,role:m?"button":void 0,tabIndex:m?0:void 0,className:"group bg-white rounded-2xl border border-gray-200 shadow-sm p-6 md:p-7 transition-transform transition-shadow duration-200 hover:shadow-md hover:-translate-y-0.5 ".concat(m?"cursor-pointer":""," ").concat(h),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[a?(0,s.jsx)("img",{src:a,alt:"".concat(t," avatar"),className:"h-10 w-10 rounded-full object-cover"}):(0,s.jsx)("div",{className:"grid h-10 w-10 place-items-center rounded-full bg-[#ecf0f1] text-[#2c3e50] text-sm font-semibold",children:function(e){let t=e.trim();return t?t.split(/\s+/).slice(0,2).map(e=>{var t;return null!=(t=e[0])?t:""}).join("").toUpperCase():"?"}(t)}),(0,s.jsxs)("div",{className:"flex min-w-0 flex-col",children:[(0,s.jsx)("span",{className:"truncate text-[15px] font-medium leading-5 text-[#2c3e50]",children:t}),(0,s.jsx)("span",{className:"text-[13px] leading-5 text-[#95a5a6]",children:n})]})]}),(0,s.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,s.jsx)("h3",{className:"text-xl font-extrabold leading-7 text-[#2c3e50] group-hover:text-[#2ECC71] transition-colors",children:l}),(0,s.jsx)("p",{className:"text-[15px] leading-7 text-gray-600 line-clamp-2",children:i}),c.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:c.map(e=>(0,s.jsx)("span",{className:"rounded-full bg-gray-100 border border-gray-200 px-3 py-1 text-[13px] leading-5 text-gray-700",children:e},e))})]}),(0,s.jsxs)("div",{className:"mt-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 text-[15px] text-[#2c3e50]",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"#3498db",strokeWidth:"2",className:"h-5 w-5",children:(0,s.jsx)("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V5a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v10z"})}),(0,s.jsx)("span",{children:r(d)})]}),(0,s.jsxs)("button",{type:"button",onClick:e=>{e.stopPropagation(),null==u||u(e)},className:"inline-flex items-center justify-center gap-2 rounded-xl bg-[#2ECC71] px-5 py-2.5 text-[15px] font-semibold text-white hover:bg-[#27AE60] w-full md:w-auto","aria-label":"我也要",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"h-5 w-5",children:(0,s.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"})}),(0,s.jsxs)("span",{children:["我也要 (",r(o),")"]})]})]})]})}a(2115)},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},9171:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var s=a(5155),r=a(2115),n=a(3540),l=a(6874),i=a.n(l),c=a(5695),o=a(2099);let d=new Set,u=async e=>{let t="comments:".concat(e);if(!d.has(t))try{var a,s,r;d.add(t);let n=(0,o.$)(),l=null!=(r=null==(s=(await n.auth.getSession()).data)||null==(a=s.session)?void 0:a.access_token)?r:"",i={};l&&(i.Authorization="Bearer ".concat(l));let c="/api/comments?creative_id=".concat(encodeURIComponent(e),"&limit=20&offset=0");fetch(c,{headers:i,cache:"default"}).catch(()=>{d.delete(t)})}catch(e){d.delete(t)}};function m(e){let{creativeId:t,children:a,className:r}=e,n="/idea/".concat(t),l=(0,c.useRouter)();return(0,s.jsx)("div",{className:"".concat(r," cursor-pointer"),onClick:e=>{let t=e.currentTarget;t.style.transform="translateY(2px) scale(0.98)",t.style.opacity="0.8",setTimeout(()=>{l.push(n)},100)},onMouseEnter:e=>{l.prefetch(n),u(t)},children:a})}var h=a(2731);function x(){let[e,t]=(0,r.useState)("热门"),[a,l]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[x,p]=(0,r.useState)(null),f=(0,c.useRouter)();(0,r.useEffect)(()=>()=>{Object.values(g.current).forEach(e=>{clearTimeout(e)})},[]),(0,r.useRef)(new Set);let g=(0,r.useRef)({});(0,r.useEffect)(()=>{(async()=>{try{u(!0);let e=await fetch("/api/creatives"),t=await e.json();e.ok?l(t.creatives||[]):p(t.message||"获取创意列表失败")}catch(e){p("网络错误，请稍后重试"),console.error("Failed to fetch creatives:",e)}finally{u(!1)}})()},[]);let v=async()=>{try{var e;let t=(0,o.$)(),{data:a,error:s}=await t.auth.getSession(),r=null==a||null==(e=a.session)?void 0:e.access_token;if(s||!r){localStorage.setItem("pendingToast","请先登录后再发布创意"),window.dispatchEvent(new Event("localToast")),f.push("/login");return}f.push("/creatives/new")}catch(e){localStorage.setItem("pendingToast","请先登录后再发布创意"),window.dispatchEvent(new Event("localToast")),f.push("/login")}},w=[...a].sort((t,a)=>{if("热门"===e){var s,r;let e=Number(null!=(s=t.upvote_count)?s:0);return Number(null!=(r=a.upvote_count)?r:0)-e}return new Date(a.created_at).getTime()-new Date(t.created_at).getTime()});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-[#2c3e50]",children:"创意广场"}),(0,s.jsx)("p",{className:"mt-2 text-[#95a5a6]",children:'连接真实需求与AI开发者，让每个好创意都能"点石成金"。'}),(0,s.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"rounded-lg bg-gray-100 p-1 inline-flex",children:["热门","最新"].map(a=>(0,s.jsx)("button",{onClick:()=>t(a),className:"px-4 py-2 text-sm font-medium rounded-md ".concat(e===a?"bg-[#2ECC71] text-white shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"),children:a},a))}),(0,s.jsx)("button",{type:"button",onClick:v,className:"rounded-lg bg-gradient-to-r from-emerald-500 to-emerald-600 px-6 py-2 text-sm font-semibold text-white shadow-md transition-all hover:shadow-lg hover:brightness-110",children:"+ 发布创意"})]}),d&&(0,s.jsxs)("div",{className:"mt-8 flex flex-col items-center space-y-4",children:[(0,s.jsx)(h.A,{size:"md"}),(0,s.jsx)("div",{className:"text-center text-gray-500",children:"正在加载创意列表..."})]}),x&&(0,s.jsx)("div",{className:"mt-8 text-center text-red-500",children:x}),!d&&!x&&(0,s.jsx)("section",{className:"mt-8",children:0===w.length?(0,s.jsxs)("div",{className:"text-center text-gray-500 mt-16",children:["还没有创意发布，快去 ",(0,s.jsx)(i(),{href:"/creatives/new",className:"text-[#3498db] hover:underline",children:"发布第一个创意"})," 吧！"]}):(0,s.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:w.map(e=>{var t,a,r;let l={id:e.id,authorName:(null==(t=e.profiles)?void 0:t.nickname)||"用户".concat(e.author_id.slice(-4)),authorAvatarUrl:null==(a=e.profiles)?void 0:a.avatar_url,publishedAtText:new Date(e.created_at).toLocaleDateString("zh-CN"),title:e.title,description:e.description,tags:Array.isArray(e.terminals)?e.terminals:[e.terminals].filter(Boolean),upvoteCount:Number(null!=(r=e.upvote_count)?r:0),commentCount:Math.floor(100*Math.random()),createdAt:new Date(e.created_at).getTime()},i=String(e.id);return(0,s.jsx)(m,{creativeId:i,className:"block",children:(0,s.jsx)(n.A,{...l})},i)})})})]})}}},e=>{e.O(0,[874,354,441,964,358],()=>e(e.s=3013)),_N_E=e.O()}]);