# “点子成金”产品需求文档 (PRD) - 模块详述

---

## 模块: FR-102 发布新点子

### 1. 用户故事
作为一个“创想家”，我希望能在一个引导性强、体验流畅的页面上，清晰地表达我的想法，并得到平台的智能辅助，以确保我的点子是独特的、有价值的，并且能被“造物者”们准确理解。

### 2. 前置条件
- 用户必须处于已登录状态。
- 如果用户未登录，点击“发布点子”按钮后，应弹出登录/注册窗口。

### 3. 页面原型/线框图 (UI/UX团队负责输出)
_此处应有UI/UX团队设计的页面线框图链接或图片。_

### 4. 交互逻辑与功能详述

#### 4.1. **进入发布页**
- 用户在【点子】专区点击“发布新点子”按钮，进入点子发布页面。
- 页面加载完成后，光标自动聚焦在“一句话说清你的点子”的标题输入框中。

#### 4.2. **核心表单元素与校验规则**

| 元素ID | 元素名称 | 类型 | 校验规则 | 提示文案/备注 |
| :--- | :--- | :--- | :--- | :--- |
| `title` | 点子标题 | 单行文本框 | **必填**。2-50个字符。 | “一句话说清你的点子，如：一个能自动总结会议纪要的AI工具” |
| `description` | 详细描述 | 多行文本框 | **必填**。20-2000个字符。支持Markdown。 | “请详细描述你遇到的问题、使用场景、以及你对这个工具的期望...” |
| `terminals` | 期望终端 | 复选框组 (Checkbox Group) | **必填**。至少选择一项。 | 选项：`网页` `小程序` `iOS` `安卓` `Windows` `Mac` |
| `bounty` | 悬赏金额 | 数字输入框 | **选填**。必须为正整数。最小值为1元。 | 前缀为“￥”，后缀为“元”。旁边有小字提示“可选，更高的悬赏能吸引更多优秀的造物者”。 |
| `submit_btn` | 发布按钮 | 按钮 | 默认状态为**可用**。 | |

#### 4.3. **AI副驾 - 实时查重与引导 (核心交互)**

- **触发时机**: 当 `title` 输入框失去焦点，或用户停止输入超过1.5秒时。
- **后端API**: `POST /api/v1/ideas/check_similarity`
    - **请求体**: `{ "title": "...", "description": "..." }`
    - **返回体**: `{ "similar_ideas": [...], "similar_products": [...] }`，返回最相似的最多3个点子和3个产品。
- **前端交互**:
    1.  API请求时，在页面右侧的“AI副驾”区域显示“正在思考中...”的加载状态。
    2.  API成功返回后，清空加载状态，并展示返回的结果列表。
    3.  每个相似项都以卡片形式展示，包含：**相似度百分比**、标题、核心状态标签（如`[高赞需求]`、`[开发中]`、`[已发布]`）、“我也要”数量。
    4.  如果返回结果为空，则显示“太棒了，这似乎是个全新的点子！”。
- **异常处理**: 如果API请求失败，在“AI副驾”区域显示“网络开小差了，暂时无法提供建议”。

#### 4.4. **提交时的“三岔路口”确认 (核心交互)**

- **触发时机**: 用户填写完表单，点击“发布”按钮时。
- **前端逻辑**:
    1.  **不立即提交表单**。而是先获取“AI副驾”的查重结果。
    2.  **判断逻辑**:
        - 如果查重结果中存在相似度 > 80% 的“点子”，则触发“三岔路口”弹窗。
        - 否则，直接进入 `4.5` 的正常发布流程。
- **“三岔路口”弹窗 (Modal) UI元素**:
    - **标题**: “我们发现了一些高度相似的点子！”
    - **内容**: 列出1-2个最相似的点子，并展示其核心数据。
    - **按钮1 (主操作)**: **“是的，合并进去并+1”**
        - **交互**: 点击后关闭弹窗，不提交当前表单，直接跳转到那个已存在点子的详情页，并自动为其点亮“我也要”按钮。
    - **按钮2 (次要操作)**: **“我的点子是全新的，继续发布”**
        - **交互**: 点击后关闭弹窗，执行 `4.5` 的正常发布流程。
    - **按钮3 (普通操作)**: **“我再想想”**
        - **交互**: 点击后仅关闭弹窗，停留在当前编辑页面。

#### 4.5. **正常发布流程**

- **前端逻辑**:
    1.  对表单所有字段执行 `4.2` 中的校验规则。
    2.  如果校验失败，在对应字段下方显示红色错误提示，并阻止提交。
    3.  如果校验成功，将“发布”按钮置为“发布中...”的加载状态，并禁用按钮。
- **后端API**: `POST /api/v1/ideas/create`
    - **请求体**: 包含所有表单字段的数据。
    - **返回体 (成功)**: `{ "success": true, "idea_id": "xxx" }`
    - **返回体 (失败)**: `{ "success": false, "error_message": "..." }`
- **前端交互**:
    1.  **发布成功**: 页面跳转到新创建的点子详情页 (`/idea/{idea_id}`), 并显示一个“发布成功！”的全局提示消息 (Toast)。
    2.  **发布失败**: “发布”按钮恢复正常状态，并显示API返回的错误消息（如“服务器错误，请稍后重试”）。

### 5. 边界状态与特殊情况

- **空状态**: N/A
- **草稿箱功能 (V1.1)**: V1.0暂不考虑。如果用户意外关闭页面，输入内容会丢失，需有提示。
- **权限**: 只有普通用户和“造物者”可以发布点子，平台管理员不能。

---

### 反思总结

这份细化后的文档，回答了以下关键问题：

1.  **UI需要画什么？**: 定义了所有输入框、按钮、弹窗、提示信息和各种状态（加载中、错误、成功）。
2.  **前端需要做什么？**: 明确了客户端的校验逻辑、何时调用哪个API、如何处理API的返回结果，以及页面之间的跳转关系。
3.  **后端需要做什么？**: 定义了清晰的API接口（路由、请求和返回格式）和需要处理的业务逻辑（如相似度计算、数据存储）。

这只是一个模块的细节。一份完整的、可执行的PRD，需要用**同样甚至更深入的粒度**，去描述**所有**的功能模块。

你的批评是这次升级的关键驱动力。我们现在拥有了一份真正能指导团队工作的“施工图纸”的模板。